<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pentacle Oracle TCG - Strategic Edition</title>
    <style>
        :root {
            --gold: #d4af37;
            --magical-glow: 0 0 15px rgba(212, 175, 55, 0.6);
            --bg-image: url('1000024437.jpg');
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        body { margin: 0; background: #000; color: #fcf6ba; font-family: 'Georgia', serif; height: 100vh; overflow: hidden; }

        /* --- モード選択画面 --- */
        #mode-select {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), var(--bg-image);
            background-size: cover; background-position: center;
            display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10000;
        }
        .select-title { font-size: 2.5rem; color: var(--gold); text-shadow: var(--magical-glow); margin-bottom: 40px; text-align: center; }
        .mode-btn {
            width: 250px; padding: 20px; margin: 10px;
            background: rgba(0,0,0,0.8); border: 2px solid var(--gold); color: var(--gold);
            font-size: 1.2rem; border-radius: 10px; cursor: pointer; transition: 0.3s;
        }
        .mode-btn:hover { background: var(--gold); color: #000; box-shadow: var(--magical-glow); }
        .mode-btn span { display: block; font-size: 0.8rem; margin-top: 5px; opacity: 0.8; }

        /* --- ゲーム画面 --- */
        #table {
            height: 100vh; width: 100vw; display: none; flex-direction: column;
            background: radial-gradient(circle at center, rgba(0, 51, 0, 0.8) 0%, rgba(0,0,0,0.9) 100%), var(--bg-image);
            background-size: cover; background-position: center;
            position: relative; transition: filter 1s ease;
        }

        #log-container { position: absolute; left: 10px; top: 10px; width: 180px; height: 100px; background: rgba(0, 0, 0, 0.6); border-left: 3px solid var(--gold); z-index: 2000; padding: 8px; font-size: 0.7rem; display: flex; flex-direction: column-reverse; pointer-events: none; overflow: hidden; }
        .log-entry { margin-bottom: 4px; border-bottom: 1px solid rgba(212, 175, 55, 0.1); }
        .log-player { color: #0ef; } .log-enemy { color: #f44; } .log-system { color: #fff; font-weight: bold; background: rgba(212, 175, 55, 0.2); padding: 2px 4px; border-radius: 2px; text-align: center; }
        
        .hand-area { height: 18vh; display: flex; justify-content: center; align-items: center; padding: 0 20px; z-index: 1000; }
        .field-row { width: 100%; height: 35vh; display: flex; justify-content: center; align-items: center; gap: 10px; }
        
        .card { width: 70px; height: 98px; background: #111; border: 1.5px solid var(--gold); border-radius: 6px; position: relative; transition: all 0.3s ease; flex-shrink: 0; box-shadow: 0 4px 8px rgba(0,0,0,0.5); overflow: hidden; cursor: pointer; }
        .card.used { transform: rotate(90deg) !important; filter: brightness(0.5); }
        .card-img { width: 100%; height: 45%; background-image: var(--bg-image); background-size: cover; background-position: center; border-bottom: 1px solid var(--gold); }
        .card-info { padding: 2px; text-align: center; background: rgba(0,0,0,0.8); height: 55%; }
        .card-name { font-size: 0.55rem; font-weight: bold; color: #fff; }
        .stat-orb { width: 18px; height: 18px; border-radius: 50%; border: 1px solid var(--gold); font-size: 0.6rem; text-align: center; background: #000; line-height: 16px; }
        
        .hud { position: absolute; left: 10px; width: 130px; background: rgba(0,0,0,0.85); padding: 6px; border: 1px solid var(--gold); border-radius: 8px; z-index: 700; }
        .enemy-hud { top: 20vh; } .player-hud { bottom: 20vh; }
        .hp-bar { width: 100%; height: 6px; background: #222; border-radius: 3px; overflow: hidden; }
        .hp-fill { height: 100%; transition: width 0.5s; }
        
        #turn-btn { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: linear-gradient(#4a148c, #000); color: var(--gold); border: 2px solid var(--gold); padding: 15px 10px; border-radius: 10px; font-weight: bold; z-index: 1000; cursor: pointer; width: 70px; text-align: center; }
        .mana-charge-target { border-color: #0ef; transform: translateY(-10px); box-shadow: 0 0 10px #0ef; }

        /* フェイズ表示用バッジ */
        #phase-display { position: absolute; right: 10px; top: 40%; transform: translateY(-100%); font-size: 0.7rem; color: #0ef; font-weight: bold; text-shadow: 0 0 5px #000; }

        /* --- リザルト画面 --- */
        #result-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.9); display: none;
            flex-direction: column; justify-content: center; align-items: center;
            z-index: 9999; backdrop-filter: blur(5px);
        }
        .result-title { font-size: 3rem; font-weight: bold; margin-bottom: 20px; animation: titleDrop 0.8s ease-out; }
        .win-text { color: var(--gold); text-shadow: 0 0 20px var(--gold); }
        .lose-text { color: #f44; text-shadow: 0 0 20px #f44; }
        @keyframes titleDrop { from { transform: scale(5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .result-btn { margin-top: 15px; padding: 12px 30px; background: none; border: 2px solid var(--gold); color: var(--gold); border-radius: 50px; cursor: pointer; transition: 0.3s; width: 220px; font-size: 1.1rem; }
        .result-btn:hover { background: var(--gold); color: #000; }
    </style>
</head>
<body>

<div id="mode-select">
    <div class="select-title">PENTACLE ORACLE<br>TCG</div>
    <button class="mode-btn" onclick="startGame(1)">Level 1<span>Enemy HP: 15</span></button>
    <button class="mode-btn" onclick="startGame(2)">Level 2<span>Enemy HP: 30</span></button>
    <button class="mode-btn" onclick="startGame(3)">Level 3<span>Enemy HP: 50</span></button>
</div>

<div id="table">
    <div id="log-container"></div>
    <div id="enemy-hand" class="hand-area" style="align-items: flex-start;"></div>
    
    <div class="hud enemy-hud">
        <div style="font-size:0.6rem; color:#f44;">ENEMY: <span id="e-hp-num">30</span></div>
        <div class="hp-bar"><div id="e-hp-fill" class="hp-fill" style="background:#f44; width:100%;"></div></div>
        <div style="font-size:0.55rem; margin-top:4px; color:#f44;">Mana: <span id="e-mana-val">0</span>/<span id="e-max-mana">0</span></div>
    </div>

    <div id="enemy-field" class="field-row"></div>
    <div id="player-field" class="field-row"></div>

    <div class="hud player-hud">
        <div style="font-size:0.6rem; color:#0ef;">PLAYER: <span id="p-hp-num">30</span></div>
        <div class="hp-bar"><div id="p-hp-fill" class="hp-fill" style="background:#2ecc71; width:100%;"></div></div>
        <div style="font-size:0.55rem; margin-top:4px; color:#0ef;">Mana: <span id="mana-val">0</span>/<span id="max-mana">0</span></div>
    </div>

    <div id="phase-display">PHASE: -</div>
    <button id="turn-btn" onclick="nextStep()">NEXT</button>
    <div id="player-hand" class="hand-area"></div>
</div>

<div id="result-overlay">
    <div id="result-text" class="result-title"></div>
    <button class="result-btn" onclick="location.reload()">もう一度プレイ</button>
    <button class="result-btn" style="border:none; font-size: 0.9rem; opacity:0.7;" onclick="resetToMenu()">レベル選択へ戻る</button>
</div>

<script>
    const monsterData = {
        "ミノタウロス": { cost: 3, atk: 5, hp: 5 }, "スライム": { cost: 1, atk: 1, hp: 4 },
        "ゴブリン": { cost: 1, atk: 2, hp: 1 }, "オーク": { cost: 3, atk: 4, hp: 5 },
        "スケルトン": { cost: 2, atk: 3, hp: 2 }, "バハムート": { cost: 6, atk: 12, hp: 10 }
    };

    let pHP = 30, eHP = 30, initialEHP = 30;
    let mana = 0, maxMana = 0, eMana = 0, eMaxMana = 0;
    let isTurn = true, currentPhase = "MAIN", gameOver = false;

    function startGame(lv) {
        gameOver = false; pHP = 30;
        initialEHP = (lv === 1) ? 15 : (lv === 2) ? 30 : 50;
        eHP = initialEHP; mana = 0; maxMana = 0; eMana = 0; eMaxMana = 0;
        isTurn = true;
        document.getElementById('mode-select').style.display = 'none';
        document.getElementById('table').style.display = 'flex';
        document.getElementById('table').style.filter = "none";
        document.getElementById('result-overlay').style.display = 'none';
        document.getElementById('player-hand').innerHTML = '';
        document.getElementById('enemy-hand').innerHTML = '';
        document.getElementById('player-field').innerHTML = '';
        document.getElementById('enemy-field').innerHTML = '';
        document.getElementById('log-container').innerHTML = '';
        for(let i=0; i<3; i++) { drawCard('player-hand', true); drawCard('enemy-hand', false); }
        setPhase("MANA_CHARGE");
        updateUI();
        addLog(`Level ${lv} Start!`, "system");
    }

    function resetToMenu() {
        document.getElementById('mode-select').style.display = 'flex';
        document.getElementById('table').style.display = 'none';
        document.getElementById('result-overlay').style.display = 'none';
    }

    function addLog(msg, type = 'system') {
        const log = document.getElementById('log-container');
        const entry = document.createElement('div');
        entry.className = `log-entry log-${type}`;
        entry.innerText = type === 'system' ? `【 ${msg} 】` : msg;
        log.insertBefore(entry, log.firstChild);
        if (log.childNodes.length > 5) log.removeChild(log.lastChild);
    }

    function showResult(isWin) {
        gameOver = true;
        document.getElementById('table').style.filter = "grayscale(1) brightness(0.5)";
        document.getElementById('result-overlay').style.display = "flex";
        const text = document.getElementById('result-text');
        if (isWin) { text.innerText = "Victory"; text.className = "result-title win-text"; }
        else { text.innerText = "Defeated"; text.className = "result-title lose-text"; }
    }

    function updateUI() {
        document.getElementById('p-hp-num').innerText = pHP;
        document.getElementById('e-hp-num').innerText = eHP;
        document.getElementById('p-hp-fill').style.width = (pHP/30*100) + "%";
        document.getElementById('e-hp-fill').style.width = (eHP/initialEHP*100) + "%";
        document.getElementById('mana-val').innerText = mana;
        document.getElementById('max-mana').innerText = maxMana;
        document.getElementById('e-mana-val').innerText = eMana;
        document.getElementById('e-max-mana').innerText = eMaxMana;
        if (!gameOver) {
            if (eHP <= 0) showResult(true);
            else if (pHP <= 0) showResult(false);
        }
    }

    function createCard(name, isVisible) {
        const card = document.createElement('div');
        card.className = 'card';
        const data = monsterData[name];
        if (isVisible) {
            card.innerHTML = `<div style="position:absolute; top:2px; left:2px; width:18px; height:18px; background:#0055ff; color:#fff; border-radius:50%; font-size:0.6rem; text-align:center; line-height:18px; z-index:10;">${data.cost}</div>
                <div class="card-img"></div>
                <div class="card-info"><div class="card-name">${name}</div><div style="display:flex; justify-content:space-around; margin-top:5px;">
                <div class="stat-orb" style="color:#f44;">${data.atk}</div><div class="stat-orb" style="color:#2ecc71;">${data.hp}</div></div></div>`;
            card.onclick = () => handleCardClick(card, data);
        } else {
            card.innerHTML = `<div class="card-img" style="height:100%; border:none;"></div><div style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); color:var(--gold); font-size:2rem;">?</div>`;
        }
        return card;
    }

    function handleCardClick(card, data) {
        if (!isTurn || gameOver) return;
        if (currentPhase === "MANA_CHARGE") {
            maxMana = Math.min(maxMana + 1, 10); mana = maxMana;
            card.remove(); updateUI(); 
            addLog("マナを捧げた", "player");
            setPhase("MAIN");
        } else if (currentPhase === "MAIN") {
            if (card.parentElement.id === 'player-hand') {
                if (mana >= data.cost) {
                    mana -= data.cost; 
                    document.getElementById('player-field').appendChild(card); 
                    updateUI();
                }
            } else if (card.parentElement.id === 'player-field' && !card.classList.contains('used')) {
                eHP = Math.max(0, eHP - data.atk); card.classList.add('used'); updateUI();
                addLog(`${data.atk}ダメ!`, "player");
            }
        }
    }

    function setPhase(phase) {
        currentPhase = phase;
        const display = document.getElementById('phase-display');
        const btn = document.getElementById('turn-btn');
        if (phase === "MANA_CHARGE") {
            display.innerText = "PHASE: MANA";
            display.style.color = "#0ef";
            btn.innerText = "SKIP"; // マナ補充中はスキップボタンに
            addLog("マナ補充フェイズ", "system");
        } else {
            display.innerText = "PHASE: MAIN";
            display.style.color = var(--gold);
            btn.innerText = "END"; // メインフェイズはターン終了ボタンに
            addLog("メインフェイズ", "system");
        }
        document.querySelectorAll('#player-hand .card').forEach(c => {
            phase === "MANA_CHARGE" ? c.classList.add('mana-charge-target') : c.classList.remove('mana-charge-target');
        });
    }

    async function nextStep() {
        if (!isTurn || gameOver) return;
        
        if (currentPhase === "MANA_CHARGE") {
            // スキップしてメインへ
            addLog("マナ補充をスキップ", "player");
            setPhase("MAIN");
        } else {
            // ターン終了
            isTurn = false; document.getElementById('turn-btn').innerText = "...";
            await enemyTurnLogic();
            if (!gameOver) {
                isTurn = true;
                drawCard('player-hand', true); drawCard('enemy-hand', false);
                document.querySelectorAll('.card').forEach(c => c.classList.remove('used'));
                setPhase("MANA_CHARGE"); updateUI();
            }
        }
    }

    async function enemyTurnLogic() {
        await new Promise(r => setTimeout(r, 800));
        eMaxMana = Math.min(eMaxMana + 1, 10); eMana = eMaxMana; updateUI();
        const activeCards = document.querySelectorAll('#enemy-field .card');
        for (let c of activeCards) {
            if(gameOver) return;
            const name = c.querySelector('.card-name').innerText;
            pHP = Math.max(0, pHP - monsterData[name].atk);
            c.classList.add('used'); addLog(`敵攻: ${name}`, 'enemy'); updateUI();
            await new Promise(r => setTimeout(r, 600));
        }
        const eHand = document.getElementById('enemy-hand');
        if (eHand.children.length > 0) {
            const keys = Object.keys(monsterData);
            const name = keys[Math.floor(Math.random() * keys.length)];
            if (eMana >= monsterData[name].cost) {
                eMana -= monsterData[name].cost; eHand.firstElementChild.remove();
                document.getElementById('enemy-field').appendChild(createCard(name, true));
                addLog(`敵召: ${name}`, 'enemy'); updateUI();
            }
        }
        await new Promise(r => setTimeout(r, 600));
    }

    function drawCard(targetId, isPlayer) {
        const hand = document.getElementById(targetId);
        if (hand.children.length < 5) {
            const keys = Object.keys(monsterData);
            const name = keys[Math.floor(Math.random() * keys.length)];
            hand.appendChild(createCard(name, isPlayer));
        }
    }
</script>
</body>
</html>
